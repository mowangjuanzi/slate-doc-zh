# ä½ç½®

> Commit ID: [469bec3d040f6272d5066b94cc827c1bb7272709](https://github.com/ianstormtaylor/slate/blob/main/docs/concepts/03-locations.md)

ä½ç½®æ˜¯åœ¨ Slate ç¼–è¾‘å™¨ä¸­æ’å…¥ã€åˆ é™¤ã€æ‰§è¡Œä»»ä½•æ“ä½œæ—¶å¼•ç”¨æ–‡æ¡£ä¸­çš„ç‰¹å®šä½ç½®çš„æ–¹å¼ã€‚æœ‰å‡ ç§ä¸åŒç±»åž‹çš„ä½ç½®æŽ¥å£ç”¨äºŽä¸åŒçš„ç”¨ä¾‹ã€‚

## `Path`

è·¯å¾„æ˜¯ä½ç½®å¼•ç”¨æœ€ä½Žå±‚æ–¹å¼ã€‚æ¯ä¸ªè·¯å¾„éƒ½æ˜¯ç®€å•çš„æ•°å­—æ•°ç»„ï¼Œé€šè¿‡æ–‡æ¡£æ ‘ä¸­çš„æ¯ä¸ªç¥–å…ˆèŠ‚ç‚¹çš„ç´¢å¼•æ¥å¼•ç”¨èŠ‚ç‚¹ï¼š

```typescript
type Path = number[]
```

ä¾‹å¦‚ï¼Œåœ¨æ–‡æ¡£ä¸­ï¼š

```javascript
const editor = {
  children: [
    {
      type: 'paragraph',
      children: [
        {
          text: 'A line of text!',
        },
      ],
    },
  ],
}
```

æ–‡æœ¬èŠ‚ç‚¹çš„å¶å­çš„è·¯å¾„æ˜¯ï¼š `[0, 0]`ã€‚

ç¼–è¾‘å™¨æœ¬èº«çš„è·¯å¾„æ˜¯ `[]`ã€‚ä¾‹å¦‚ï¼Œè°ƒç”¨ `Transforms.select(editor, [])` é€‰æ‹©ç¼–è¾‘å™¨çš„å…¨éƒ¨å†…å®¹ã€‚

## `Point`

ç‚¹æ¯”è·¯å¾„æ›´åŠ å…·ä½“ï¼Œä¸”åŒ…å«ç‰¹å®šæ–‡æœ¬çš„ `offset`ã€‚æŽ¥å£æ˜¯ï¼š

```typescript
interface Point {
  path: Path
  offset: number
}
```

ä¾‹å¦‚ï¼Œå¯¹äºŽåŒä¸€ä¸ªæ–‡æ¡£ï¼Œå¦‚æžœæƒ³å¼•ç”¨ç¬¬ä¸€ä¸ªä½ç½®ï¼Œå¯ä»¥å°†å…‰æ ‡æ”¾åœ¨ï¼š

```javascript
const start = {
  path: [0, 0],
  offset: 0,
}
```

æˆ–è€…æƒ³å¼•ç”¨å¥å­çš„ç»“å°¾ï¼š

```javascript
const end = {
  path: [0, 0],
  offset: 15,
}
```

å°†ç‚¹è§†ä¸ºâ€œå…‰æ ‡â€ï¼ˆâ€œæ’å…¥ç¬¦å·â€ï¼‰å¯èƒ½ä¼šæœ‰æ‰€å¸®åŠ©ã€‚

> ðŸ¤– ç‚¹_æ€»æ˜¯_æŒ‡çš„æ˜¯æ–‡æœ¬èŠ‚ç‚¹ï¼å› ä¸ºå®ƒä»¬æ˜¯å”¯ä¸€æœ‰å…‰æ ‡çš„å­—ç¬¦ä¸²ã€‚

## `Range`

èŒƒå›´ä¸ä»…ä»…å¯ä»¥å¼•ç”¨æ–‡æ¡£ä¸­çš„å•ä¸ªç‚¹ï¼Œè¿˜å¯ä»¥å¼•ç”¨ä¸¤ä¸ªç‚¹ä¹‹é—´æ›´å¹¿æ³›çš„å†…å®¹ã€‚ï¼ˆèŒƒå›´çš„ä¾‹å­æ˜¯é€‰åŒºã€‚ï¼‰æŽ¥å£æ˜¯ï¼š

```typescript
interface Range {
  anchor: Point
  focus: Point
}
```

> ðŸ¤– æœ¯è¯­â€œé”šç‚¹â€ï¼ˆanchorï¼‰å’Œâ€œç„¦ç‚¹â€ï¼ˆfocusï¼‰æ˜¯ä»Ž DOM ä¸­å€Ÿç”¨çš„ï¼Œå‚é˜…[é”šç‚¹](https://developer.mozilla.org/en-US/docs/Web/API/Selection/anchorNode)å’Œ[ç„¦ç‚¹](https://developer.mozilla.org/en-US/docs/Web/API/Selection/focusNode)ã€‚

é”šç‚¹å’Œç„¦ç‚¹æ˜¯é€šè¿‡ç”¨æˆ·äº¤äº’ç¡®å®šçš„ã€‚åœ¨æ–‡æ¡£ä¸­é”šç‚¹ä¸æ€»æ˜¯åœ¨ç„¦ç‚¹_ä¹‹å‰_ã€‚å°±åƒåœ¨ DOM ä¸­ï¼Œé”šç‚¹å’Œç„¦ç‚¹çš„é¡ºåºå–å†³äºŽèŒƒå›´æ˜¯å‘åŽè¿˜æ˜¯å‘å‰ã€‚

ä»¥ä¸‹æ˜¯ç«ç‹å¼€å‘è€…ç½‘ç»œçš„è§£é‡Šï¼š

> ç”¨æˆ·å¯èƒ½ä»Žå·¦åˆ°å³ï¼ˆä¸Žæ–‡æ¡£æ–¹å‘ç›¸åŒï¼‰é€‰æ‹©æ–‡æœ¬æˆ–ä»Žå³åˆ°å·¦ï¼ˆä¸Žæ–‡æ¡£æ–¹å‘ç›¸åï¼‰é€‰æ‹©æ–‡æœ¬ã€‚é”šç‚¹æŒ‡å‘ç”¨æˆ·å¼€å§‹é€‰æ‹©çš„åœ°æ–¹ï¼Œè€Œç„¦ç‚¹æŒ‡å‘ç”¨æˆ·ç»“æŸé€‰æ‹©çš„åœ°æ–¹ã€‚å¦‚æžœä½¿ç”¨é¼ æ ‡é€‰æ‹©æ–‡æœ¬çš„è¯ï¼Œé”šç‚¹å°±æŒ‡å‘æŒ‰ä¸‹é¼ æ ‡é”®çš„åœ°æ–¹ï¼Œè€Œç„¦ç‚¹å°±æŒ‡å‘æ¾å¼€é¼ æ ‡é”®çš„åœ°æ–¹ã€‚é”šç‚¹å’Œç„¦ç‚¹çš„æ¦‚å¿µä¸èƒ½ä¸Žé€‰åŒºçš„èµ·å§‹ä½ç½®å’Œç»ˆæ­¢ä½ç½®æ··æ·†ï¼Œå› ä¸ºé”šç‚¹æŒ‡å‘çš„ä½ç½®å¯èƒ½åœ¨ç„¦ç‚¹æŒ‡å‘çš„ä½ç½®çš„å‰é¢ï¼Œä¹Ÿå¯èƒ½åœ¨ç„¦ç‚¹æŒ‡å‘ä½ç½®çš„åŽé¢ï¼Œè¿™å–å†³äºŽé€‰æ‹©æ–‡æœ¬æ—¶é¼ æ ‡ç§»åŠ¨çš„æ–¹å‘ï¼ˆä¹Ÿå°±æ˜¯æŒ‰ä¸‹é¼ æ ‡é”®å’Œæ¾å¼€é¼ æ ‡é”®çš„ä½ç½®ï¼‰ã€‚ â€”â€” [`Selection`, MDN](https://developer.mozilla.org/en-US/docs/Web/API/Selection)

ä¸€ä¸ªé‡è¦çš„åŒºåˆ«æ˜¯åœ¨æ–‡æ¡£ä¸­èŒƒå›´çš„é”šç‚¹å’Œç„¦ç‚¹**å§‹ç»ˆå¼•ç”¨æ–‡æœ¬èŠ‚ç‚¹å¶å­**ä¸”ç»ä¸å¼•ç”¨å…ƒç´ ã€‚æ­¤è¡Œä¸ºä¸Ž DOM ä¸åŒï¼Œä½†ç®€åŒ–äº†ä½¿ç”¨èŒƒå›´ï¼Œä¸”éœ€è¦å¤„ç†çš„è¾¹ç¼˜æƒ…å†µæ›´å°‘ã€‚

> ðŸ¤– å‚è€ƒ[èŒƒå›´ API å‚è€ƒ](../api/locations/range.md)èŽ·å–æ›´å¤šä¿¡æ¯ã€‚

## é€‰åŒº

å½“éœ€è¦å¼•ç”¨ä¸¤ç‚¹ä¹‹é—´çš„å†…å®¹èŒƒå›´æ—¶ï¼ŒSlate API çš„ä¸­å¾ˆå¤šåœ°æ–¹éƒ½ä½¿ç”¨äº†èŒƒå›´ã€‚æœ€å¸¸è§çš„ç¤ºä¾‹æ˜¯ç”¨æˆ·çš„å½“å‰â€œé€‰åŒºâ€ã€‚

é€‰åŒºæ˜¯ä¸€ä¸ªç‰¹æ®ŠèŒƒå›´ï¼Œæ˜¯é¡¶çº§ `Editor` çš„å±žæ€§ã€‚ä¾‹å¦‚ï¼Œå‡è®¾å½“å‰é€‰æ‹©äº†æ•´ä¸ªå¥å­ï¼š

```javascript
const editor = {
  selection: {
    anchor: { path: [0, 0], offset: 0 },
    focus: { path: [0, 0], offset: 15 },
  },
  children: [
    {
      type: 'paragraph',
      children: [
        {
          text: 'A line of text!',
        },
      ],
    },
  ],
}
```

> ðŸ¤– é€‰åŒºæ¦‚å¿µä¹Ÿæ˜¯ä»Ž DOM ä¸­å€Ÿç”¨çš„ï¼Œå‚é˜… [`Selection`, MDN](https://developer.mozilla.org/en-US/docs/Web/API/Selection), å°½ç®¡å½¢å¼éžå¸¸ç®€åŒ–ï¼Œå› ä¸º Slate ä¸å…è®¸åœ¨å•ä¸ªé€‰åŒºä¸­åŒ…å«å¤šä¸ªèŒƒå›´ï¼Œä½†ä¹Ÿä½¿å¾—æ˜“äºŽä½¿ç”¨ã€‚

æ²¡æœ‰ç‰¹å®šçš„ `Selection` æŽ¥å£ã€‚å®ƒåªæ˜¯æ­£å¥½éµå¾ªäº†æ›´é€šç”¨çš„ `Range` æŽ¥å£ã€‚

ä¾‹å¦‚ï¼Œè¦æ‰¾åˆ°åŒ…å«æ‰€æœ‰å½“å‰é€‰åŒºçš„æœ€ä½Žçš„å—ï¼š

```javascript
function getCommonBlock(editor) {
  const range = Editor.unhangRange(editor, editor.selection, { voids: true })

  let [common, path] = SlateNode.common(
    editor,
    range.anchor.path,
    range.focus.path
  )

  if (Editor.isBlock(editor, common) || Editor.isEditor(common)) {
    return [common, path]
  } else {
    return Editor.above(editor, {
      at: path,
      match: n => Editor.isBlock(editor, n) || Editor.isEditor(n),
    })
  }
}
```
